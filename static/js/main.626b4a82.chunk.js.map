{"version":3,"sources":["TVProgram.js","ChannelSelector.js","App.js","index.js"],"names":["TVProgram","program","filter","item","now","Date","startDate","start","endDate","setSeconds","getSeconds","parseInt","duration","dateISO","date","hours","getHours","minutes","getMinutes","dateClass","IS_FINISHING_PERCENT","_this","this","currentChannel","props","channels","channelIndex","logoUrl","undefined","BASE_API_URL","logo","mbNoProgram","length","filteredProgram","filterProgram","react_default","a","createElement","className","src","alt","map","index","classNames","key","formatTime","title","Component","ChannelSelector","id","value","currentChannelIndex","onChange","ch","chid","App","Object","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","selectChannel","bind","assertThisInitialized","getChannels","getProgram","state","channelProgram","_this2","axios","then","res","setState","data","xvid","catch","err","alert","_this3","date_from","date_to","toISOString","substr","setDate","getDate","url","format","e","chIndex","target","ChannelSelector_ChannelSelector","TVProgram_TVProgram","String","prototype","k","arguments","replace","ReactDOM","render","App_App","document","getElementById"],"mappings":"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","file":"static/js/main.626b4a82.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport { IS_FINISHING_PERCENT, BASE_API_URL } from './App';\n\n\nexport default class TVProgram extends Component {\n  filterProgram(program) {\n    return program.filter(\n      function(item) {\n        var now = new Date();\n        var startDate = new Date(item.start);\n        var endDate = new Date(item.start);\n        endDate.setSeconds(startDate.getSeconds() + parseInt(item.duration));\n        return (endDate >= now);\n      }\n    )\n  };\n\n  formatTime(dateISO) {\n    var date = new Date(dateISO);\n    var hours = date.getHours();\n    var minutes = date.getMinutes()\n    if (hours   < 10) \n      {hours   = \"0\"+hours;}\n    if (minutes < 10) \n      {minutes = \"0\"+minutes;}\n    return hours+':'+minutes;\n  };\n\n  dateClass(date, duration) {\n    var now = new Date();\n    var startDate = new Date(date);\n    var endDate = new Date(date);\n    endDate.setSeconds(startDate.getSeconds() + parseInt(duration));\n    var dateClass = \"\";\n\n    if (startDate <= now) {\n      var timePercent = (endDate - startDate)/100;\n      var timedeltaToEnd = (endDate - now);\n      \n      if (timedeltaToEnd < timePercent*IS_FINISHING_PERCENT) { //isFinishing\n        dateClass = 'list-group-item-danger';\n      } else {\n        dateClass = 'list-group-item-success';\n      }\n    }\n    return dateClass;\n  }\n\n  render() {\n    var currentChannel = this.props.channels[this.props.channelIndex];\n    var logoUrl = \n      (this.props.channelIndex !== undefined) ?\n        BASE_API_URL + currentChannel.logo : \"\"\n    var mbNoProgram = this.props.program.length === 0 ? \"Нет программы\" : \"\";\n    var filteredProgram = this.filterProgram(this.props.program)\n\n    return (\n      <div className=\"pt-2 pb-2\">\n        <div>\n          <img src={logoUrl} alt=\"No logo\"></img>\n        </div>\n        <div className=\"p-2\">{mbNoProgram}</div>\n        <ul className=\"list-group\">\n\n          {filteredProgram.map((program, index) => {\n              var addClass = this.dateClass(program.start, program.duration);\n              var classNames = 'list-group-item ' + addClass;\n              return (\n                <li key={index} className={classNames}>\n                  {this.formatTime(program.start)} {program.title} \n                </li>\n              )\n          })}\n\n        </ul>\n      </div>\n    )\n  }\n}\n","import React, { Component } from 'react';\n\nexport default class ChannelSelector extends Component {\n  render() {\n    return (\n      <div className=\"pt-2\">\n        <div>Выберите канал:</div>\n        <select id=\"channel\" className=\"custom-select w-auto\"\n        value={this.props.currentChannelIndex} \n        onChange={this.props.onChange}>\n          {this.props.channels.map((ch, index) => {\n            return (\n              <option key={ch.chid} value={index}> {ch.title} </option>\n            )\n          })}\n        </select>\n      </div>\n    )\n  }\n}\n","import React, { Component } from 'react';\nimport * as axios from 'axios';\nimport './App.css';\nimport TVProgram from './TVProgram';\nimport ChannelSelector from './ChannelSelector';\n\nexport const BASE_API_URL = \"http://epg.domru.ru\"\nexport const IS_FINISHING_PERCENT = 20;\n\nexport default class App extends Component  {\n  constructor(props) {\n    super(props);\n    this.selectChannel = this.selectChannel.bind(this);\n    this.getChannels = this.getChannels.bind(this);\n    this.getProgram = this.getProgram.bind(this);\n    this.state = {\n      channels: [],\n      currentChannelIndex: undefined,\n      channelProgram: []\n    };\n  }\n\n  componentWillMount() {\n    this.getChannels();\n  }\n\n  getChannels() {\n    axios.get(BASE_API_URL + '/channel/list?domain=perm')\n      .then((res) => {\n        this.setState({\n          channels: res.data,\n          currentChannelIndex: 0\n        });\n        var xvid = this.state.channels[0].xvid;\n        this.getProgram(xvid);\n      })\n      .catch((err) => {\n        alert(\"Error while get list of channels!\");\n      });\n  }\n\n  getProgram(xvid) {\n    var date_from = new Date();\n    var date_to = new Date();\n    date_from = date_from.toISOString().substr(0,10);\n    date_to = new Date(date_to.setDate(date_to.getDate() + 1)).toISOString().substr(0,10);\n    var url = '{0}/program/list?date_from={1}+00:00:00&date_to={2}+00:00:00&domain=perm&xvid[0]={3}'.format(BASE_API_URL, date_from, date_to, xvid);\n    axios.get(url)\n      .then((res) => {\n        this.setState({\n          channelProgram: res.data[xvid] || []\n        });\n      })\n      .catch((err) => {\n        this.setState({\n          channelProgram: []\n        });\n        alert(\"Error while get list of program for the channel!\");\n      });\n  }\n\n  selectChannel(e) {\n    var chIndex = e.target.value;\n    this.setState({currentChannelIndex: chIndex})\n    var xvid = this.state.channels[chIndex].xvid;\n    this.getProgram(xvid)\n  }\n\n  render() {\n\n    return (\n      <div className=\"container pt-2 pb-2\">\n        <h2 className=\"h2\">TV-программа dom.ru</h2>\n        <div className=\"\">\n          <ChannelSelector\n            onChange={this.selectChannel}\n            channels={this.state.channels}\n          />\n        </div>\n        <TVProgram\n          channels={this.state.channels}\n          channelIndex={this.state.currentChannelIndex}\n          program={this.state.channelProgram}\n        />\n      </div>\n    );\n  }\n}\n\nvar string = String;\nstring.prototype.format = function() {\n  var a = this;\n  for (var k in arguments) {\n    a = a.replace(\"{\" + k + \"}\", arguments[k])\n  }\n  return a\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport 'bootstrap/dist/css/bootstrap.min.css';\n// import $ from 'jquery';\n// import Popper from 'popper.js';\n// import 'bootstrap/dist/js/bootstrap.bundle.min';\n// import * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n"],"sourceRoot":""}